###################################
COPY FILES FROM COMPUTER TO CLUSTER
###################################

1. COPY SCRIPTS

scp /Users/quim/Dropbox/Postdoc/Projects/Scipher/SampleSizeEffect/scripts/* discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts

2. COPY DATA FILES

scp -r /Users/quim/Documents/DATA/BioGroup/Scipher/data/bootstrap discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/data
scp -r /Users/quim/Documents/DATA/BioGroup/Scipher/data/bootstrap/responders discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/data/bootstrap


######################################
CREATE RENV ENVIRONMENT IN THE CLUSTER
######################################

##### CONDA #####

# Install
srun --partition=short --nodes=1 --cpus-per-task=1 --pty /bin/bash
module load python/3.8.1
module load R/4.0.3
module load anaconda3/3.7
conda create -n SampleSizeR r-essentials r-base
source activate SampleSizeR
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("BiRewire")
install.packages('devtools')
devtools::install_github('RfastOfficial/Rfast')
devtools::install_github('deisygysi/NetSci')
BiocManager::install("WGCNA")
BiocManager::install("minet")
install.packages('optparse')
install.packages('dplyr')
install.packages('RcppEigen')

# Solve problem of Error in if (nzchar(SHLIB_LIBADD)): https://stackoverflow.com/questions/53813323/installing-r-packages-in-macos-mojave-error-in-if-nzcharshlib-libadd 

# There are the following Makeconf files:
find ~ -name Makeconf
/home/j.aguirreplans/.conda/pkgs/r-pbdzmq-0.3_3-r36h5455479_1/lib/R/library/pbdZMQ/etc/Makeconf
/home/j.aguirreplans/.conda/pkgs/r-base-3.6.1-haffb61f_2/lib/R/etc/Makeconf
/home/j.aguirreplans/.conda/envs/SampleSizeR/lib/R/etc/Makeconf
/home/j.aguirreplans/.conda/envs/SampleSizeR/lib/R/library/pbdZMQ/etc/Makeconf

# The Makeconf file in /home/j.aguirreplans/.conda/envs/SampleSizeR/lib/R/etc/Makeconf is empty, so we substitute it for the one in /home/j.aguirreplans/.conda/envs/SampleSizeR/lib/R/etc/Makeconf
mv /home/j.aguirreplans/.conda/envs/SampleSizeR/lib/R/etc/Makeconf /home/j.aguirreplans/.conda/envs/SampleSizeR/lib/R/etc/Makeconf.backup
cp /home/j.aguirreplans/.conda/pkgs/r-base-3.6.1-haffb61f_2/lib/R/etc/Makeconf /home/j.aguirreplans/.conda/envs/SampleSizeR/lib/R/etc/Makeconf

# Load
srun --partition=short --nodes=1 --cpus-per-task=1 --pty /bin/bash
module load python/3.8.1
module load R/4.0.3
module load anaconda3/3.7
source activate SampleSizeR

# Deactivate
conda deactivate


##### PACKRAT #####

# Initialize the project
srun --partition=short --nodes=1 --cpus-per-task=1 --pty /bin/bash
module load R/4.0.3
cd /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts
mkdir SampleSizeR
R
install.packages("packrat")
packrat::init("/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/SampleSizeR")

# Install packages
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("BiRewire")
install.packages('devtools')
devtools::install_github('RfastOfficial/Rfast')
devtools::install_github('deisygysi/NetSci')
install.packages(c('optparse', 'tidyr'))
install.packages('RcppEigen')
install.packages('mltools')
BiocManager::install("WGCNA")
BiocManager::install("minet")
install.packages(c("patchwork", "plotly"))
install.packages("Hmisc")

# Install wto from github
library(devtools)
install_github("deisygysi/wTO") 

# Save changes
packrat::snapshot()

# Close project


##### RENV #####

srun --partition=short --nodes=1 --cpus-per-task=1 --pty /bin/bash
module load R/4.0.3
R
install.packages("renv")
renv::init("/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/SampleSizeR")
renv::install("bioc::BiRewire")
renv::install("RfastOfficial/Rfast")
renv::install("deisygysi/NetSci")
renv::install("optparse")
renv::install("RcppEigen")
renv::install("tidyr")
renv::install("bioc::WGCNA")


install.packages('devtools')
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("BiRewire")
devtools::install_github('RfastOfficial/Rfast')
devtools::install_github('deisygysi/NetSci')
install.packages('optparse')
install.packages('dplyr')
install.packages('RcppEigen')
BiocManager::install("WGCNA")

renv::snapshot() # To save the changes in the renv environment

Include this line at the beginning of the R script:
renv::init("/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/SampleSizeR")

Clear all variables in the environment:
rm(list=ls())

########################################
INSTALL R PACKAGES TO RUN IN THE CLUSTER
########################################

¡¡¡¡¡ This might not be necessary anymore because I can use the renv environment !!!!!

https://thecoatlessprofessor.com/programming/r/working-with-r-on-a-cluster/ 

1. CREATE R_LIBS

mkdir ~/Rlibs

2. LOAD R MODULE

module load R/4.0.3

3. EXPORT R ENVIRONMENT

export R_LIBS=~/Rlibs

4. INSTALL PACKAGES

module load R/4.0.3
R
install.packages('devtools')
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
library(devtools)
install_github('deisygysi/NetSci')
install.packages('optparse')
install.packages('RcppEigen')
BiocManager::install("WGCNA")

All the packages are installed in:

ls /home/j.aguirreplans/R/x86_64-pc-linux-gnu-library/4.0/


#########################
RUN A TEST IN THE CLUSTER
#########################

sbatch /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/generate_cn_test.sh
squeue -u j.aguirreplans
sacct


#############################################################
RUN GENERATION OF CO-EXPRESSION NETWORKS USING WTO IN CLUSTER
#############################################################

module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_wto_cluster.py

squeue -u j.aguirreplans
sacct


#######################################################################
RUN GENERATION OF CO-EXPRESSION NETWORKS USING OTHER METRICS IN CLUSTER
#######################################################################

module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/bootstrap/nonresponders -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100 -m wto
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/bootstrap/responders -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_responders_wto_N100 -m wto
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_cluster.py -m wgcna
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_cluster.py -m pearson
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_cluster.py -m spearman

python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/bootstrap/nonresponders -o /scratch/j.aguirreplans/Scipher/SampleSize/example_wto -m wto

# Using samples files
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Liver -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Liver -m wto

#### GTEx ####

# WTO CONVERGENCE: All genes - Spleen - Female
module load python/3.8.1
# For the moment only 20 to try how much time do they take (2021/12/16, 17:14)
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_with_wto_finding_pvalue_convergence_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Spleen_female -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/GTEx_RNASeq_Spleen_female.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Spleen_female

# WTO FASTER: All genes - Spleen
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Spleen_female -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/GTEx_RNASeq_Spleen_female.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Spleen_female -m wto
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Spleen_male -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/GTEx_RNASeq_Spleen_male.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Spleen_male -m wto

# WTO FASTER: All genes - Whole blood
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Whole.Blood -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/gtex_rnaseq_Whole.Blood.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood -m wto

# WGCNA: All genes - Spleen
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Spleen_female -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/GTEx_RNASeq_Spleen_female.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Spleen_female -m wgcna
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Spleen_male -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/GTEx_RNASeq_Spleen_male.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Spleen_male -m wgcna

# WGCNA: All genes - Whole Blood
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Whole.Blood_female -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/gtex_rnaseq_Whole.Blood_female.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood_female -m wgcna
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Whole.Blood_male -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/gtex_rnaseq_Whole.Blood_male.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood_male -m wgcna
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Whole.Blood -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/gtex_rnaseq_Whole.Blood.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood -m wgcna

# Pearson: All samples - Whole Blood
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Whole.Blood -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/gtex_rnaseq_Whole.Blood.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood -m pearson

# Spearman: All samples - Whole Blood
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Whole.Blood -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/gtex_rnaseq_Whole.Blood.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood -m spearman

# ARACNE: All genes - Spleen
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Spleen_female -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/GTEx_RNASeq_Spleen_female.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Spleen_female -m aracne
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Spleen_male -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/GTEx_RNASeq_Spleen_male.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Spleen_male -m aracne

# ARACNE: All genes - Whole Blood
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Whole.Blood_female -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/gtex_rnaseq_Whole.Blood_female.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood_female -m aracne
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Whole.Blood_male -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/gtex_rnaseq_Whole.Blood_male.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood_male -m aracne
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/GTEx/sampling_with_repetition/Whole.Blood -r /home/j.aguirreplans/Databases/GTEx/v8/tpm_filtered_files_by_tissue/gtex_rnaseq_Whole.Blood.gct -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood -m aracne

#### SCIPHER (NEW DATASET) ####

# WTO FASTER: All samples (100 jobs sent)
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/complete_dataset -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/complete_dataset -m wto

# WGCNA: All samples
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/complete_dataset -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/complete_dataset -m wgcna
# WGCNA: All samples baseline
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/samples_baseline -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/samples_baseline -m wgcna
# WGCNA: Sample per patient baseline
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/sample_per_patient_baseline -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/sample_per_patient_baseline -m wgcna
# WGCNA: Responder baseline
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/responder_baseline -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/responder_baseline -m wgcna
# WGCNA: Nonresponder baseline
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/nonresponder_baseline -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/nonresponder_baseline -m wgcna

# Spearman: All samples
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/complete_dataset -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/complete_dataset -m spearman
# Spearman: All samples baseline
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/samples_baseline -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/samples_baseline -m spearman
# Spearman: Sample per patient baseline
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/sample_per_patient_baseline -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/sample_per_patient_baseline -m spearman
# Spearman: Responder baseline
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/responder_baseline -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/responder_baseline -m spearman
# Spearman: Nonresponder baseline
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/nonresponder_baseline -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/nonresponder_baseline -m spearman

# Pearson: All samples
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/complete_dataset -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/complete_dataset -m pearson

# ARACNE: All samples
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/create_gene_coexpression_networks_from_samples_cluster.py -i /home/j.aguirreplans/Projects/Scipher/SampleSize/data/sampling/Scipher/Dec2021/sampling_with_repetition/complete_dataset -r /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_counts_processed.csv -o /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/complete_dataset -m aracne


squeue -u j.aguirreplans
sacct
sacct -ojobid,jobname,state,nodelist

Check memory (WTO):
seff 21612351
Job ID: 21612351
Cluster: discovery
User/Group: j.aguirreplans/users
State: COMPLETED (exit code 0)
Cores: 1
CPU Utilized: 04:47:25
CPU Efficiency: 99.95% of 04:47:33 core-walltime
Job Wall-clock time: 04:47:33
Memory Utilized: 32.21 GB
Memory Efficiency: 32.98% of 97.66 GB

seff 21612312
Job ID: 21612312
Cluster: discovery
User/Group: j.aguirreplans/users
State: COMPLETED (exit code 0)
Cores: 1
CPU Utilized: 09:10:24
CPU Efficiency: 99.99% of 09:10:26 core-walltime
Job Wall-clock time: 09:10:26
Memory Utilized: 33.96 GB
Memory Efficiency: 34.77% of 97.66 GB

Job failed because of memory:
Job ID: 21623791
Cluster: discovery
User/Group: j.aguirreplans/users
State: FAILED (exit code 1)
Cores: 1
CPU Utilized: 15:48:46
CPU Efficiency: 99.79% of 15:50:47 core-walltime
Job Wall-clock time: 15:50:47
Memory Utilized: 31.67 GB
Memory Efficiency: 81.08% of 39.06 GB

#################################
TRANSFER FILES OUT OF THE CLUSTER
#################################

Network files:

sshfs j.aguirreplans@xfer.discovery.neu.edu:/scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100/* /System/Volumes/Data/Volumes/QUIM/DATA/Scipher/SampleSize/networks_nonresponders_wto_N100

Scripts:

scp discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/\* /Users/j.aguirreplans/Dropbox/Postdoc/Projects/Scipher/SampleSize/scripts/
scp discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/\*.html /Users/j.aguirreplans/Desktop/results_GTEx
scp discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/\*.html /Users/quim/Desktop/results_GTEx

Results:

scp discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/GTEx_analysis/\* /Users/j.aguirreplans/Desktop/results_GTEx
scp discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/GTEx_analysis/\* /Users/quim/Desktop/results_GTEx


#########################################
CREATE VIRTUAL ENVIRONMENT IN THE CLUSTER
#########################################

Create conda environment:
https://rc-docs.northeastern.edu/en/latest/software/conda.html#creating-python 

srun --partition=short --nodes=1 --cpus-per-task=1 --pty /bin/bash
module load python/3.8.1
module load anaconda3/3.7
conda create -n ScipherSampleSizeEnv
source activate ScipherSampleSizeEnv

Run conda environment using OnDemand:
https://rc-docs.northeastern.edu/en/latest/using-ood/interactiveapps.html

To install NetworkMedicineToolbox, I just cloned the repository in the scripts directory.
To update NetworkMedicineToolbox, I just have to:
cd /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/NetworkMedicineToolbox
git pull origin master

Install modules:
srun --partition=short --nodes=1 --cpus-per-task=1 --pty /bin/bash
module load python/3.8.1
module load anaconda3/3.7
source activate ScipherSampleSizeEnv
pip install GEOparse

To use the function girvan_newman of networkx, there was an incompatibility with the package decorator, it required a version of decorator lower than 5. So I have downgraded it:
source activate ScipherSampleSizeEnv
pip install --upgrade decorator==4.3

######################################################
ANALYSIS OF GENE CO-EXPRESSION NETWORKS IN THE CLUSTER
######################################################


# 10,000 genes, NONRESPONDERS, N20, pvals 0.05, 0.01, 0.001
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N50 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_sample_size
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_G10000_N20 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_sample_size_G10000_N20_pval_0.05 -p 0.05
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_G10000_N20 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_sample_size_G10000_N20_pval_0.01 -p 0.01
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_G10000_N20 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_sample_size_G10000_N20_pval_0.001 -p 0.001

# All genes, NONRESPONDERS, N100, pvals 0.05, 0.01, top 100
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_nonresponders_wto_N100_pval_0.05_top_100 -p 0.05
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_nonresponders_wto_N100_pval_0.01_top_100 -p 0.01

# All genes, NONRESPONDERS, N100, pvals 0.01, 0.05, tops 0.1, 0.5, 1
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_nonresponders_wto_N100_pval_0.01_top_0.1 -p 0.01 -t 0.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_nonresponders_wto_N100_pval_0.01_top_0.5 -p 0.01 -t 0.5
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_nonresponders_wto_N100_pval_0.01_top_1 -p 0.01 -t 1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_nonresponders_wto_N100_pval_0.05_top_0.1 -p 0.05 -t 0.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_nonresponders_wto_N100_pval_0.05_top_0.5 -p 0.05 -t 0.5
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_nonresponders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_nonresponders_wto_N100_pval_0.05_top_1 -p 0.05 -t 1

# All genes, RESPONDERS, N100, pvals 0.01, 0.05, tops 0.1, 0.5, 1
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_responders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_responders_wto_N100_pval_0.01_top_0.1 -p 0.01 -t 0.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_responders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_responders_wto_N100_pval_0.01_top_0.5 -p 0.01 -t 0.5
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_responders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_responders_wto_N100_pval_0.01_top_1 -p 0.01 -t 1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_responders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_responders_wto_N100_pval_0.05_top_0.1 -p 0.05 -t 0.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_responders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_responders_wto_N100_pval_0.05_top_0.5 -p 0.05 -t 0.5
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_by_size_cluster.py -n /scratch/j.aguirreplans/Scipher/SampleSize/networks_responders_wto_N100 -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_responders_wto_N100_pval_0.05_top_1 -p 0.05 -t 1


# GTEx: All genes - Spleen
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_cluster.py -i /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Spleen_female -p /home/j.aguirreplans/data/PPI/interactome_tissue_specific/interactome_2019_Spleen_female.csv -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_gtex/Spleen_female
# TO DO
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_cluster.py -i /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Spleen_male -p /home/j.aguirreplans/data/PPI/interactome_tissue_specific/interactome_2019_Spleen_male.csv -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_gtex/Spleen_male

# GTEx: All genes - Whole Blood
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_cluster.py -i /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood_female -p /home/j.aguirreplans/data/PPI/interactome_tissue_specific/interactome_2019_Whole.Blood_female.csv -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_gtex/Whole.Blood_female
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_cluster.py -i /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood_male -p /home/j.aguirreplans/data/PPI/interactome_tissue_specific/interactome_2019_Whole.Blood_male.csv -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_gtex/Whole.Blood_male
# NEW
module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_cluster.py -i /scratch/j.aguirreplans/Scipher/SampleSize/networks_gtex/Whole.Blood -p /home/j.aguirreplans/data/PPI/interactome_2019_merged_symbols.csv -d /home/j.aguirreplans/Projects/Scipher/SampleSize/data/disease_genes/disease_genes_info_2022.csv -e /home/j.aguirreplans/Projects/Scipher/SampleSize/data/essential_genes/OGEE_essential_genes.csv -g /home/j.aguirreplans/Databases/GTEx/v8/genes_filtered_files_by_tissue/gtex_rnaseq_gene_info_Whole.Blood.csv -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_gtex/Whole.Blood -n /scratch/j.aguirreplans/Scipher/SampleSize/subgraphs_gtex/Whole.Blood


#### SCIPHER (NEW DATASET) ####

module load python/3.8.1
python /home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/analyze_gene_coexpression_networks_cluster.py -i /scratch/j.aguirreplans/Scipher/SampleSize/networks_scipher/complete_dataset -p /home/j.aguirreplans/data/PPI/interactome_2019_merged_symbols.csv -d /home/j.aguirreplans/Projects/Scipher/SampleSize/data/disease_genes/disease_genes_info_2022_scipher.csv -e /home/j.aguirreplans/Projects/Scipher/SampleSize/data/essential_genes/OGEE_essential_genes_scipher.csv -g /home/j.aguirreplans/Projects/Scipher/SampleSize/data/Dec2021/00_data/scipher_rnaseq_gene_info.csv -o /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_scipher/complete_dataset -n /scratch/j.aguirreplans/Scipher/SampleSize/subgraphs_scipher/complete_dataset
# output analysis: /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/analysis_scipher/complete_dataset
# output networks: /home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/networks_scipher/complete_dataset

# Copy results
scp -r discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/data/out/plots_N100 /Users/quim/Desktop

######################################
ANALYSIS DISEASE GENES VS. SAMPLE SIZE
######################################

Download data from COVID-19 project: https://github.com/Barabasi-Lab/COVID-19/blob/main/data/Guney2016_GenesDisease.tsv
Download data from Entrez to Gene symbol: https://ftp.ncbi.nih.gov/gene/DATA/GENE_INFO/Mammalia/
Download data from MeSH (mtrees2021.bin): https://nlmpubs.nlm.nih.gov/projects/mesh/MESH_FILES/meshtrees/ 

Transfer data to the cluster:
scp /Users/quim/Dropbox/References/Gysi_PNAS21_Supplementary/Guney2016_GenesDisease.tsv discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/data
scp /Users/quim/Documents/DATA/BioGroup/Scipher/data/Homo_sapiens.gene_info discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/data
scp /Users/quim/Documents/Databases/MeSH/mtrees2021.bin discovery:/home/j.aguirreplans/Databases/MeSH

How to plot it?
---------------
- Group diseases by disease type: for example, first branch of MeSH.
- Make a plot for each group of diseases and check which diseases are more representative of each group.
- Choose the most representative diseases of each group and make a plot of it.
- Get the genes of all diseases of each group to make another plot.


Run shiny app:

module load R/4.0.3
R
setwd('/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts')
shiny::runApp(SampleSizeShiny)

or
shiny::runApp('/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/SampleSizeShiny')



###################################
ANALYSIS USING RA DATASET FROM ENZO
###################################

Download data from: https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE97810

- Non normalized data: GSE97810_non-normalized_baseline.txt.gz
- Soft formatted family file: GSE97810_family.soft

Transfer data to the cluster:
scp -r /Users/quim/Documents/DATA/BioGroup/Scipher/data/RA discovery:/home/j.aguirreplans/Projects/Scipher/SampleSize/data

Run script to import data:
sbatch /home/j.aguirreplans/Projects/Scipher/SampleSize/data/RA/scripts/data_import_GSE97810.sh



#############
UPDATE GITHUB
#############

# I don't know why it only works in the login node, not in the other ones
# Go to the folder
cd /home/j.aguirreplans/Projects/Scipher/SampleSize

# To add new changes:
git add .
git commit -m "Calculate networks for Scipher"
git push origin

# To pull changes from the repository:
git pull origin master

# Get personal token to authentificate for 2 factor authentification (in case it has expired):
Go to Github > Settings > Developer Settings > Personal access tokens
Token: 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


