---
title: "GEO"
author: "Joaquim Aguirre-Plans"
date: '2023-02-02'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Description

Analyze GEO dataset.

```{r, message=FALSE}
packrat::init("/home/j.aguirreplans/Projects/Scipher/SampleSize/scripts/SampleSizeR")
```

```{r, message=FALSE}
library(data.table)
library(dplyr)
library(GEOquery)
library(ggplot2)
require(magrittr)
library(tidyr)
set.seed(1510)
```

### Access the GEO Series data

```{r}
geo_id = "GSE193677"
```

```{r}
### This will download a 20 Mb
gse <- getGEO(geo_id, GSEMatrix = TRUE)
show(gse)
```

### Access raw files

```{r}
filePaths = getGEOSuppFiles(geo_id, makeDirectory = TRUE, baseDir = "/work/ccnr/j.aguirreplans/Databases/GEO")
filePaths
```

### Access GSE Data Tables from GEO

To access the phenotypic information about the samples, the best way is to use getGEO() function to obtain the GSE object and then extract the phenoData object from that. Unfortunately this means downloadint the entire GSE Matrix file.

```{r}
dim(pData(gse[[1]]))
head(pData(gse[[1]])[, 1:3])
```

Sometimes GSEs are include separate data tables with the sample information. If these exist, you can uuse the getGSEDataTables() function. For example here is the phenoData object from a different GSE accession GSE3494 with a Data Table.

```{r}
df1 <- getGSEDataTables(geo_id)
lapply(df1, head)
```


